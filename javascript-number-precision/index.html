<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/blog/component---src-layouts-index-tsx-9e882ea38acd00a1221a.js" as="script"/><link rel="preload" href="/blog/component---src-templates-blog-post-tsx-4a472efa7d7886c2b0a9.js" as="script"/><link rel="preload" href="/blog/path---javascript-number-precision-ad9af8133835ff006f22.js" as="script"/><link rel="preload" href="/blog/app-dfa073c62e34b396bd52.js" as="script"/><link rel="preload" href="/blog/commons-a5db421de3683ad0b4ee.js" as="script"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml"/><title data-react-helmet="true">【转】JavaScript浮点数运算精度缺失 | 剑与魔法</title><style id="gatsby-inlined-css">.site-header{position:relative;width:100%;border-top:2px solid #000;padding-bottom:70px}.site-header__logo{position:absolute;width:160px;height:82px;top:0;left:50%;margin-left:-80px;background:#000;padding:10px 0 12px}.site-header__title{font-size:24px;line-height:1.6}.site-header__desc,.site-header__title{display:block;text-align:center;color:#fff}.site-header__desc{font-size:13px}.site-nav-switch{float:right;margin-top:20px;border:0;outline:none;cursor:pointer;transition:all .24s ease}.site-nav-switch i{font-size:30px}.menu-open .site-nav-switch{transform:rotate(90deg)}.header-wrapper{position:relative;width:100%;height:70px;background:#fff;box-shadow:0 0 3px rgba(0,0,0,.1);border-bottom:1px solid #e1e2e3;padding:0 20px}/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}@font-face{font-family:iconfont;src:url(/blog/static/iconfont.6660bc40.eot);src:url(/blog/static/iconfont.6660bc40.eot#iefix) format("embedded-opentype"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAcUAAsAAAAACjAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAAQwAAAFZW7k6BY21hcAAAAYAAAACEAAAB1rC2p6pnbHlmAAACBAAAAu8AAAOUTUtjDWhlYWQAAAT0AAAALwAAADYRKz3zaGhlYQAABSQAAAAeAAAAJAhyBBpobXR4AAAFRAAAABYAAAAcHHwAAGxvY2EAAAVcAAAAEAAAABAC6AOqbWF4cAAABWwAAAAfAAAAIAEXAGNuYW1lAAAFjAAAAUUAAAJtPlT+fXBvc3QAAAbUAAAAQAAAAFEmDC4veJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkEWKcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGBwYKt7UMjf8b2CIYW5gaAAKM4LkAOLODAoAeJzFkVEKhDAMRCfbKiKy5/Bj0Yt4AI/Sn3rciOAddNLogidwwiudkJCSAqgABPIjEZAFAlNiVko+oC35iIm+Q4MP70l7Hddtz8dh1XTD390SVlt8GeYqdgbUZU6N1yTvjX6qK+d8OdtIuuATtXfsh3RwuD/o6NivrZtjvXt2EE+18CCneJxtkttr1EAUxudMNpNLu5s2t2myyXYv3cRau9bsNvFCu/UCtlLEIq0KrrRQUZCqaEELClEpXkGhIPZN2lJ997W0Dz755r8g+iT4JvpkdHatguBkEs6cgd/J+c6HeIR+fuA2uC6koR1oDzqCTiAEpA+KGexCwa9VcB8YBd6geobzS35BKBUr3BDQItHNIKx5lAhEgQzkoFoIQr+CfRisDeMDEJgugJW1T6plR+Wegdzl5xaTY3gFjO6Sowz3J2O76nqQ18Qb7apqqeoTkfC8iHFKycAcNSVekkmyxiu2sdHdi7uh3fLt8TPpfFadeVC77JapBBDHoGXzmVf1TruT7Vu2qamW0JEWu+x0qUeHG5/aurR21/uI2ALW6zv8hYuQipAEzQYiGIaa54PH2qH4ZRLLuiXDEvsNPrkgW7oMMctZmgRLRJEVAkuSZsnbrLf48x8WE6IoMBV0k0JTFh+mocVK5posWP7NghYrmWuxWAG9xSKMtZpa4hpIZFNwkM+mMMVK1LzfIrOg1IyqQcj9J+ezKAOGTkmp6O0GtoXIYzOAapAD0IlAfXZTwduJcXfA8wZceO1SxbYV6t53BsrlAQcu5cxmwsy9UM3p1UZa1zKOaonUfda7fmXr6vk3N2H2+OH8tSl/eqUB51amz67O4AXq5vpdJ/nWYdndtgXVf89f8ennZ/p3YsylgCdjt+fXGHl8MZk7vBBcrBsnHq09mph4vK3nkxRw82gUoU5dpWZQhzAaAlLBu6GCo5CaURhVmLkiLwpzQMOADmNqCqbBWmRe06nOPBiqg8yyzLxbL4iIUxjK+wtWSpF6VCGoFyfl3PzVyHTcUbdt39P96fwhJ6vvvXa9D0AUl99OPNx8v/lwAq6vJ98HAXOQ4mdTkua0e4qlCPbZqtHrGncbp0YOjuKsJnZ0SMw0R0dGTjXu6X1DdwATQmrQ9uoigzBW03Nc6xPjmEUCakNIKxh/n5hDP9CfF8eT8VQ8idAvKRGhlgB4nGNgZGBgAGLRYuGV8fw2Xxm4WRhA4Nqemt8I+n8Py2TmEiCXg4EJJAoANOULqgB4nGNgZGBgbvjfwBDDMpmB4f9/IAkUQQHsAIsmBZQAAHicY2FgYGB+ycDAwgDFkxFsAB0EAZgAAAAAAAAAdgCcAMIBRAGwAcp4nGNgZGBgYGcIZ2BjAAEmIOYCQgaG/2A+AwASEAF7AHicZY9NTsMwEIVf+gekEqqoYIfkBWIBKP0Rq25YVGr3XXTfpk6bKokjx63UA3AejsAJOALcgDvwSCebNpbH37x5Y08A3OAHHo7fLfeRPVwyO3INF7gXrlN/EG6QX4SbaONVuEX9TdjHM6bCbXRheYPXuGL2hHdhDx18CNdwjU/hOvUv4Qb5W7iJO/wKt9Dx6sI+5l5XuI1HL/bHVi+cXqnlQcWhySKTOb+CmV7vkoWt0uqca1vEJlODoF9JU51pW91T7NdD5yIVWZOqCas6SYzKrdnq0AUb5/JRrxeJHoQm5Vhj/rbGAo5xBYUlDowxQhhkiMro6DtVZvSvsUPCXntWPc3ndFsU1P9zhQEC9M9cU7qy0nk6T4E9XxtSdXQrbsuelDSRXs1JErJCXta2VELqATZlV44RelzRiT8oZ0j/AAlabsgAAAB4nGNgYoAALgbsgJ2RiZGZkYWRlZGNkZ2Rg4GxgiUvtaKEuaAola08NTkjsYQtPbMkozSJJTc1r5SBAQC2qgqI") format("woff"),url(/blog/static/iconfont.f97650f9.ttf) format("truetype"),url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiID4KPCEtLQoyMDEzLTktMzA6IENyZWF0ZWQuCi0tPgo8c3ZnPgo8bWV0YWRhdGE+CkNyZWF0ZWQgYnkgaWNvbmZvbnQKPC9tZXRhZGF0YT4KPGRlZnM+Cgo8Zm9udCBpZD0iaWNvbmZvbnQiIGhvcml6LWFkdi14PSIxMDI0IiA+CiAgPGZvbnQtZmFjZQogICAgZm9udC1mYW1pbHk9Imljb25mb250IgogICAgZm9udC13ZWlnaHQ9IjUwMCIKICAgIGZvbnQtc3RyZXRjaD0ibm9ybWFsIgogICAgdW5pdHMtcGVyLWVtPSIxMDI0IgogICAgYXNjZW50PSI4OTYiCiAgICBkZXNjZW50PSItMTI4IgogIC8+CiAgICA8bWlzc2luZy1nbHlwaCAvPgogICAgCiAgICA8Z2x5cGggZ2x5cGgtbmFtZT0ieCIgdW5pY29kZT0ieCIgaG9yaXotYWR2LXg9IjEwMDEiCmQ9Ik0yODEgNTQzcS0yNyAtMSAtNTMgLTFoLTgzcS0xOCAwIC0zNi41IC02dC0zMi41IC0xOC41dC0yMyAtMzJ0LTkgLTQ1LjV2LTc2aDkxMnY0MXEwIDE2IC0wLjUgMzB0LTAuNSAxOHEwIDEzIC01IDI5dC0xNyAyOS41dC0zMS41IDIyLjV0LTQ5LjUgOWgtMTMzdi05N2gtNDM4djk3ek05NTUgMzEwdi01MnEwIC0yMyAwLjUgLTUydDAuNSAtNTh0LTEwLjUgLTQ3LjV0LTI2IC0zMHQtMzMgLTE2dC0zMS41IC00LjVxLTE0IC0xIC0yOS41IC0wLjUKdC0yOS41IDAuNWgtMzJsLTQ1IDEyOGgtNDM5bC00NCAtMTI4aC0yOWgtMzRxLTIwIDAgLTQ1IDFxLTI1IDAgLTQxIDkuNXQtMjUuNSAyM3QtMTMuNSAyOS41dC00IDMwdjE2N2g5MTF6TTE2MyAyNDdxLTEyIDAgLTIxIC04LjV0LTkgLTIxLjV0OSAtMjEuNXQyMSAtOC41cTEzIDAgMjIgOC41dDkgMjEuNXQtOSAyMS41dC0yMiA4LjV6TTMxNiAxMjNxLTggLTI2IC0xNCAtNDhxLTUgLTE5IC0xMC41IC0zN3QtNy41IC0yNXQtMyAtMTV0MSAtMTQuNQp0OS41IC0xMC41dDIxLjUgLTRoMzdoNjdoODFoODBoNjRoMzZxMjMgMCAzNCAxMnQyIDM4cS01IDEzIC05LjUgMzAuNXQtOS41IDM0LjVxLTUgMTkgLTExIDM5aC0zNjh6TTMzNiA0OTh2MjI4cTAgMTEgMi41IDIzdDEwIDIxLjV0MjAuNSAxNS41dDM0IDZoMTg4cTMxIDAgNTEuNSAtMTQuNXQyMC41IC01Mi41di0yMjdoLTMyN3oiIC8+CiAgICAKCiAgICAKICAgIDxnbHlwaCBnbHlwaC1uYW1lPSJuZXh0IiB1bmljb2RlPSImIzU4OTI2OyIgZD0iTTY3MiAzODRsLTM4NC0zODRjLTEyLjgtMTIuOC0xMi44LTMyIDAtNDQuOCAxMi44LTEyLjggMzItMTIuOCA0NC44IDBsNDAzLjIgNDAzLjJjNi40IDYuNCAxMi44IDE5LjIgMTIuOCAyNS42IDAgNi40IDAgMTkuMi02LjQgMjUuNkwzMzIuOCA4MTIuOEMzMjAgODI1LjYgMzAwLjggODI1LjYgMjg4IDgxMi44UzI3NS4yIDc4MC44IDI4OCA3NjhMNjcyIDM4NHoiICBob3Jpei1hZHYteD0iMTAyNCIgLz4KCiAgICAKICAgIDxnbHlwaCBnbHlwaC1uYW1lPSJwcmUiIHVuaWNvZGU9IiYjNTg5Mjc7IiBkPSJNMzUyIDM4NGwzODQgMzg0YzEyLjggMTIuOCAxMi44IDMyIDAgNDQuOC0xMi44IDEyLjgtMzIgMTIuOC00NC44IDBMMjg4IDQwOS42QzI4MS42IDQwMy4yIDI3NS4yIDM5MC40IDI3NS4yIDM4NGMwLTYuNCAwLTE5LjIgNi40LTI1LjZsNDA5LjYtNDA5LjZjMTIuOC0xMi44IDMyLTEyLjggNDQuOCAwczEyLjggMzIgMCA0NC44TDM1MiAzODR6IiAgaG9yaXotYWR2LXg9IjEwMjQiIC8+CgogICAgCiAgICA8Z2x5cGggZ2x5cGgtbmFtZT0id2VjaGF0IiB1bmljb2RlPSImIzYwNTQxOyIgZD0iTTMzMS41NTY1NzEgNjMyLjUzOTQyOXEwIDIzLjQwNTcxNC0xNC4yNjI4NTcgMzcuNzQxNzE0dC0zNy43NDE3MTQgMTQuMjYyODU3cS0yNC41NzYgMC00My40NDY4NTctMTQuNTU1NDI5dC0xOC44NzA4NTctMzcuNDQ5MTQzcTAtMjIuMzA4NTcxIDE4Ljg3MDg1Ny0zNi44NjR0NDMuNDQ2ODU3LTE0LjU1NTQyOXEyMy40MDU3MTQgMCAzNy43NDE3MTQgMTMuOTcwMjg2dDE0LjI2Mjg1NyAzNy40NDkxNDN6TTc1Ni4xNTA4NTcgMzQyLjgyMDU3MXEwIDE2LjAxODI4Ni0xNC41NTU0MjkgMjguNTk4ODU3dC0zNy40NDkxNDMgMTIuNTgwNTcxcS0xNS40MzMxNDMgMC0yOC4zMDYyODYtMTIuODczMTQzdC0xMi44NzMxNDMtMjguMzA2Mjg2cTAtMTYuMDE4Mjg2IDEyLjg3MzE0My0yOC44OTE0Mjl0MjguMzA2Mjg2LTEyLjg3MzE0M3EyMi44MjA1NzEgMCAzNy40NDkxNDMgMTIuNTgwNTcxdDE0LjU1NTQyOSAyOS4xMTA4NTd6TTYyMS4yNzU0MjkgNjMyLjUzOTQyOXEwIDIzLjQwNTcxNC0xMy45NzAyODYgMzcuNzQxNzE0dC0zNy40NDkxNDMgMTQuMjYyODU3cS0yNC41NzYgMC00My40NDY4NTctMTQuNTU1NDI5dC0xOC44NzA4NTctMzcuNDQ5MTQzcTAtMjIuMzA4NTcxIDE4Ljg3MDg1Ny0zNi44NjR0NDMuNDQ2ODU3LTE0LjU1NTQyOXEyMy40MDU3MTQgMCAzNy40NDkxNDMgMTMuOTcwMjg2dDEzLjk3MDI4NiAzNy40NDkxNDN6TTk4NC4xMzcxNDMgMzQyLjgyMDU3MXEwIDE2LjAxODI4Ni0xNC44NDggMjguNTk4ODU3dC0zNy4xNTY1NzEgMTIuNTgwNTcxcS0xNS40MzMxNDMgMC0yOC4zMDYyODYtMTIuODczMTQzdC0xMi44NzMxNDMtMjguMzA2Mjg2cTAtMTYuMDE4Mjg2IDEyLjg3MzE0My0yOC44OTE0Mjl0MjguMzA2Mjg2LTEyLjg3MzE0M3EyMi4zMDg1NzEgMCAzNy4xNTY1NzEgMTIuNTgwNTcxdDE0Ljg0OCAyOS4xMTA4NTd6TTgzMi4xNDYyODYgNTY5LjcwOTcxNHEtMTcuNzAwNTcxIDIuMjY3NDI5LTQwLjAwOTE0MyAyLjI2NzQyOS05Ni41NDg1NzEgMC0xNzcuNzM3MTQzLTQ0LjAzMnQtMTI3LjcwNzQyOS0xMTkuMTQ5NzE0LTQ2LjU5Mi0xNjQuMjc4ODU3cTAtNDQuNTQ0IDEzLjE2NTcxNC04Ni44MjA1NzEtMTkuOTY4LTEuNjgyMjg2LTM4LjgzODg1Ny0xLjY4MjI4Ni0xNC44NDggMC0yOC41OTg4NTcgMC44Nzc3MTR0LTMxLjQ1MTQyOSAzLjczMDI4Ni0yNS40NTM3MTQgNC4wMjI4NTctMzEuMTU4ODU3IDUuOTk3NzE0LTI4LjU5ODg1NyA1Ljk5NzcxNGwtMTQ0LjYwMzQyOS03Mi41NTc3MTQgNDEuMTc5NDI5IDEyNC41NjIyODZxLTE2NS43NDE3MTQgMTE2LjAwNDU3MS0xNjUuNzQxNzE0IDI3OS45OTA4NTcgMCA5Ni41NDg1NzEgNTUuNzM0ODU3IDE3Ny43MzcxNDN0MTUwLjgyMDU3MSAxMjcuNzA3NDI5IDIwNy43MjU3MTQgNDYuNTkycTEwMC41NzE0MjkgMCAxOTAuMDI1MTQzLTM3Ljc0MTcxNHQxNDkuNzIzNDI5LTEwNC4zMDE3MTQgNzcuOTcwMjg2LTE0OC44NDU3MTR6TTExNzAuNDMyIDI0OS4xMjQ1NzFxMC02Ni44NTI1NzEtMzkuMTMxNDI5LTEyNy43MDc0Mjl0LTEwNS45ODQtMTEwLjU5MmwzMS40NTE0MjktMTAzLjQyNC0xMTMuNzM3MTQzIDYyLjMxNzcxNHEtODUuNzIzNDI5LTIxLjEzODI4Ni0xMjQuNTYyMjg2LTIxLjEzODI4Ni05Ni41NDg1NzEgMC0xNzcuNzM3MTQzIDQwLjMwMTcxNHQtMTI3LjcwNzQyOSAxMDkuNDIxNzE0LTQ2LjU5MiAxNTAuODIwNTcxIDQ2LjU5MiAxNTAuODIwNTcxIDEyNy43MDc0MjkgMTA5LjQyMTcxNCAxNzcuNzM3MTQzIDQwLjMwMTcxNHE5Mi4wMTM3MTQgMCAxNzMuMTI5MTQzLTQwLjMwMTcxNHQxMjkuOTc0ODU3LTEwOS43MTQyODYgNDguODU5NDI5LTE1MC42MDExNDN6IiAgaG9yaXotYWR2LXg9IjExNzEiIC8+CgogICAgCiAgICA8Z2x5cGggZ2x5cGgtbmFtZT0iZ2l0aHViIiB1bmljb2RlPSImIzU4OTIwOyIgZD0iTTAgMzcxLjAwOHEwLTE2Ni4wMTYgOTUuNDg4LTI5OC40OTZ0MjQ3LjQ4OC0xODUuNTA0cTYuMDE2LTAuOTkyIDEwLjAxNi0wLjk5MnQ2LjQ5NiAxLjUwNCA0IDMuMDA4IDIuMDE2IDQuOTkyIDAuNTEyIDQuOTkydjEwMC41MTJxLTM2Ljk5Mi00LTY2LjAxNiAwLjUxMnQtNDUuNTA0IDE0LjAxNi0yOC45OTIgMjMuNDg4LTE2Ljk5MiAyNS41MDQtOC45OTIgMjQtNS41MDQgMTQuNDk2cS04Ljk5MiAxNS4wMDgtMjcuMDA4IDI3LjQ4OHQtMjcuMDA4IDIwLTIuMDE2IDE0LjQ5NnE1MC4wMTYgMjYuMDE2IDExMi45OTItNjYuMDE2IDM0LjAxNi01MS4wMDggMTE5LjAwOC0zMC4wMTYgMTAuMDE2IDQwLjk5MiA0MCA3MC4wMTZRMjkzLjk4NCAxNjAgMjM3Ljk4NCAyMjUuMDI0dC01NiAxNTguMDE2cTAgODcuMDA4IDU1LjAwOCAxNTEuMDA4LTIyLjAxNiA2NC45OTIgNi4wMTYgMTM2Ljk5MiAyOC45OTIgMi4wMTYgNjQuOTkyLTExLjQ4OHQ1MC40OTYtMjMuMDA4IDI1LjUwNC0xNy41MDRxNTYuOTkyIDE2IDEyOC41MTIgMTZ0MTI5LjUwNC0xNnExMi45OTIgOC45OTIgMjguOTkyIDE5LjAwOHQ0OC45OTIgMjEuNTA0IDYwLjk5MiA5LjUwNHEyNy4wMDgtNzEuMDA4IDcuMDA4LTEzNS4wMDggNTYtNjQgNTYtMTUxLjAwOCAwLTkyLjk5Mi01Ni45OTItMTU4LjQ5NnQtMTcyLTg1LjUwNHE0My4wMDgtNDMuMDA4IDQzLjAwOC0xMDR2LTEyOC45OTJxMC0wLjk5MiAwLjk5Mi0zLjAwOCAwLTYuMDE2IDAuNTEyLTguOTkydDQuNTEyLTYuMDE2IDEyLTMuMDA4cTE1Mi45OTIgNTIgMjUwLjQ5NiAxODUuNTA0dDk3LjUwNCAzMDAuNTEycTAgMTA0LTQwLjUxMiAxOTkuMDA4dC0xMDguOTkyIDE2My40ODgtMTYzLjQ4OCAxMDguOTkyVDUxMi4wMzIgODgzLjA0IDMxMy4wMjQgODQyLjUyOCAxNDkuNTM2IDczMy41MzZ0LTEwOC45OTItMTYzLjQ4OC00MC41MTItMTk5LjAwOHoiICBob3Jpei1hZHYteD0iMTAyNCIgLz4KCiAgICAKICAgIDxnbHlwaCBnbHlwaC1uYW1lPSJtZW51IiB1bmljb2RlPSImIzU5MzY5OyIgZD0iTTEyOCA2NDBoNzY4di04NS4zMzMzMzNIMTI4VjY0MG0wLTIxMy4zMzMzMzNoNzY4di04NS4zMzMzMzRIMTI4djg1LjMzMzMzNG0wLTIxMy4zMzMzMzRoNzY4di04NS4zMzMzMzNIMTI4djg1LjMzMzMzM3oiICBob3Jpei1hZHYteD0iMTAyNCIgLz4KCiAgICAKCgogIDwvZm9udD4KPC9kZWZzPjwvc3ZnPgo=#iconfont) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-next:before{content:"\E62E"}.icon-pre:before{content:"\E62F"}.icon-wechat:before{content:"\EC7D"}.icon-github:before{content:"\E628"}.icon-menu:before{content:"\E7E9"}body{width:100%;height:100%;font-family:montserrat,Helvetica,Arial,Hiragino Sans GB,Hiragino Sans GB W3,Microsoft JhengHei,WenQuanYi Micro Hei,Microsoft YaHei,sans-serif;line-height:1.5em;color:#414141;text-rendering:geometricPrecision;background-color:#ebecee}#___gatsby,.site-root,body,html{margin:0;height:100%}a{color:#414141;text-decoration:none}*{box-sizing:border-box;outline:0;margin:0;padding:0}h1,h2,h3,h4,h5,h6{margin:0 0 .4em}.post-list{width:760px;margin:0 auto}.post,.post-list{position:relative}.post{padding:40px 40px 50px;background:#fff;box-shadow:0 0 3px rgba(0,0,0,.15);margin-bottom:50px}.post__title{font-size:22.5px;padding:0 20px}.post__time,.post__title{display:block;text-align:center}.post__time{color:#b5b5b5;font-size:13.5px;margin-bottom:30px;font-weight:300}.post__content{color:#464646;font-size:14px;line-height:1.75em}.post__content a{color:#f59200}.post__content a:hover{color:#f08f00;background:rgba(255,152,0,.1)}.post__content a.gatsby-resp-image-link:hover{background:initial}.post__content h1,.post__content h2,.post__content h3,.post__content h4,.post__content h5,.post__content h6{position:relative;margin:40px auto 30px}.post__content h1:before,.post__content h2:before,.post__content h3:before,.post__content h4:before,.post__content h5:before,.post__content h6:before{position:absolute;left:-1em;top:0;content:"#";color:#4caf50;font-weight:400}.post__content h1 svg,.post__content h2 svg,.post__content h3 svg,.post__content h4 svg,.post__content h5 svg,.post__content h6 svg{display:none}.post__content p{margin:.8em 0}.post__content ol li{margin-left:1em}.post-list .post__title a{transition:all .24s ease}.post-list .post__title a:hover{color:#55b559}.gatsby-highlight pre[class*=language-]{background:#f9f9f9}.gatsby-highlight pre[class*=language-] code{font-family:Monaco;font-size:13px;font-weight:300}.site-main{max-width:820px;margin:0 auto;padding:0 20px 20px}.site-footer,.site-main{position:relative;width:100%}.site-footer{padding:0 20px 30px;margin:30px auto 0;font-size:14px;overflow:hidden;text-align:center}.site-sidebar{position:fixed;top:0;right:0;width:280px;z-index:9;height:100%;padding:20px;background-image:url(/blog/static/sidebar-bg.075cfde0.png);background-repeat:repeat;background-size:102px 102px;transform:translate3d(280px,0,0)}.site-sidebar,.site-sidebar .dark-btn{transition:all .24s ease;text-align:center}.site-sidebar .dark-btn{display:inline-block;background:rgba(0,0,0,.3);border:1px solid #000;padding:5px 10px;font-size:13px;color:#c2c2c2}.site-sidebar .dark-btn:hover{background-color:#009688;color:#f5f5f5}.site-sidebar .sidebar-switch{margin:0 auto 20px}.site-sidebar .sidebar-switch .dark-btn{width:100px;cursor:pointer}.site-sidebar .sidebar-switch .dark-btn.active{background-color:#009688;color:#f5f5f5}.site-bio{text-align:center}.site-bio .about-me{background:rgba(0,0,0,.1);border:1px solid #262626;padding:12px 5px 15px}.site-bio .avator{display:block;width:96px;height:96px;margin:4px auto;background:rgba(0,0,0,.3);border-radius:50%;border:1px solid #000;padding:3px;overflow:hidden}.site-bio .avator img{display:block;width:100%;height:100%;border-radius:50%}.site-bio .info{color:#a9a9a9;margin-top:10px;line-height:140%;padding:0 15px;font-size:12px}.site-bio .name{padding:5px 10px}.site-bio .menu{margin:15px auto}.site-bio .menu-item{width:40%;margin:0 5%;margin-bottom:10px}.site-toc{background:rgba(0,0,0,.1);border:1px solid #262626;max-height:450px;overflow:auto}.toc{display:block;position:relative;padding:0;text-align:left;margin:12px 10px 15px}.toc-child{padding-left:10px}.toc-item{list-style-type:none}.toc-link{color:#eee;font-size:13px;transition:all .24s ease}.toc-link:hover{color:#009688}.toc-number{font-size:14px;margin-right:4px}.site-bio,.site-toc{transition:all .24s ease -1s;opacity:0;max-height:0;transform:translate3d(0,-20px,0)}.site-bio.show,.site-toc.show{transition:all .24s ease;opacity:1;max-height:none;transform:translateZ(0)}.site-wrapper{position:relative;transition:all .24s ease;min-height:100%}.site-wrapper__overlay{position:absolute;top:0;right:0;bottom:0;left:0;background-color:hsla(0,0%,100%,.5);transition:all .24s ease;z-index:999;visibility:hidden;opacity:0}.menu-open .site-wrapper{transform:translate3d(-280px,0,0)}.menu-open .site-wrapper__overlay{visibility:visible;opacity:1}.menu-open .site-sidebar{transform:translateZ(0)}.social-wrapper{padding-top:20px}.social-wrapper a{color:#828282;position:relative;display:inline-block;text-align:center;font-size:16px;margin:0 5px}.social-wrapper a:hover{color:#55acee}.page-nav{position:relative}.page-nav__next,.page-nav__prev{color:#a7a7a7;border-radius:2px;padding:3px 10px;transition:all .24s ease}.page-nav__next:hover,.page-nav__prev:hover{color:#fff;background:#414141}.page-nav__next .text,.page-nav__prev .text{margin:0 4px}.page-nav__next .icon,.page-nav__prev .icon{font-size:12px;font-weight:600}.page-nav__prev{float:left}.page-nav__next{float:right}code[class*=language-],pre[class*=language-]{color:#a9b7c6;font-family:Consolas,Monaco,Andale Mono,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{color:inherit;background:rgba(33,66,131,.85)}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{color:inherit;background:rgba(33,66,131,.85)}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.prolog{color:gray}.token.atrule,.token.boolean,.token.delimiter,.token.important,.token.keyword,.token.selector{color:#cc7832}.token.attr-name,.token.operator,.token.punctuation{color:#a9b7c6}.token.builtin,.token.doctype,.token.tag,.token.tag .punctuation{color:#e8bf6a}.token.entity,.token.number,.token.symbol{color:#6897bb}.token.constant,.token.property,.token.variable{color:#9876aa}.token.char,.token.string{color:#6a8759}.token.attr-value,.token.attr-value .punctuation{color:#a5c261}.token.attr-value .punctuation:first-child{color:#a9b7c6}.token.url{color:#287bde;text-decoration:underline}.token.function{color:#ffc66d}.token.regex{background:#364135}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.inserted{background:#294436}.token.deleted{background:#484a4a}code.language-css .token.property,code.language-css .token.property+.token.punctuation{color:#a9b7c6}code.language-css .token.id,code.language-css .token.selector>.token.attribute,code.language-css .token.selector>.token.class,code.language-css .token.selector>.token.pseudo-class,code.language-css .token.selector>.token.pseudo-element{color:#ffc66d}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100.4124805c.woff2) format("woff2"),url(/blog/static/montserrat-latin-100.c8fb2f71.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic.e4bf47bd.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic.d1f3f2d0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200.444ae007.woff2) format("woff2"),url(/blog/static/montserrat-latin-200.edbce16a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic.f316c5d1.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic.d7bbb730.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300.0a7c6df0.woff2) format("woff2"),url(/blog/static/montserrat-latin-300.5e86df2c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic.c076c489.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic.37c74a8d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400.501ce09c.woff2) format("woff2"),url(/blog/static/montserrat-latin-400.f29d2b85.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic.882908d9.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic.22e7b04e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500.f0f2716c.woff2) format("woff2"),url(/blog/static/montserrat-latin-500.991b453b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic.4590ebba.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic.f3d41e4c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600.15c24f71.woff2) format("woff2"),url(/blog/static/montserrat-latin-600.f6dc6096.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic.6d10b805.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic.02c48333.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700.79982cd1.woff2) format("woff2"),url(/blog/static/montserrat-latin-700.957e93fb.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic.283438e9.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic.ca627c5c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800.35386154.woff2) format("woff2"),url(/blog/static/montserrat-latin-800.75665590.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic.e1b52a7b.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic.a69f0add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900.260c2ea3.woff2) format("woff2"),url(/blog/static/montserrat-latin-900.186cae80.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic.d785fb9f.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic.43b527fe.woff) format("woff")}</style></head><body><div id="___gatsby"><div class="site-wrapper"><div class="site-wrapper__overlay"></div><header class="site-header"><div class="header-wrapper"><a class="site-header__logo" href="/blog/"><span class="site-header__title">剑与魔法</span><span class="site-header__desc">次元壁垒即将打破</span></a><button class="site-nav-switch"><i class="iconfont icon-menu"></i></button></div></header><main class="site-main"><section class="post"><h1 class="post__title">【转】JavaScript浮点数运算精度缺失</h1><div class="post__time">June 19, 2018</div><div class="post__content"><p>原文链接 <a href="http://www.css88.com/archives/7340#more-7340">http://www.css88.com/archives/7340#more-7340</a></p>
<h2 id="问题描述"><a href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题描述</h2>
<p>在JavaScrip中的整数和浮点数都属于<code class="language-text">Number</code>数据类型，所有的数字都是以64位浮点数的形式存储的，即便整数也是如此，所以我们打印<code class="language-text">1.00</code>这样的浮点数的结果是<code class="language-text">1</code>而非<code class="language-text">1.00</code>。在一些特殊的数值表示中，例如金额，这样看上去有点变扭，但至少是正确了。然而要命的是，当浮点数做数学运算的时候，你经常会发现一些问题，举几个例子：</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code class="language-javascript"><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">=</span> <span class="token number">0.30000000000000004</span>
<span class="token number">0.3</span> <span class="token operator">-</span> <span class="token number">0.2</span> <span class="token operator">=</span> <span class="token number">0.09999999999999998</span>
<span class="token number">19.9</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">=</span> <span class="token number">1989.9999999999998</span>
<span class="token number">0.3</span> <span class="token operator">/</span> <span class="token number">0.1</span> <span class="token operator">=</span> <span class="token number">2.9999999999999996</span></code></pre>
      </div>
<h2 id="问题的原因"><a href="#%E9%97%AE%E9%A2%98%E7%9A%84%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题的原因</h2>
<p>JavaScript里的数字采用<a href="https://zh.wikipedia.org/wiki/IEEE_754">IEEE 754标准</a>的64位双精度浮点数，对于64位浮点数在内存中的表示，最高的1位是符号位，接着是11位是指数，剩下的52位为有效数字，具体：</p>
<ul>
<li>第0位：符号位，s标识，0表示正数，1表示负数；</li>
<li>第1位到第11位：存储指数部分，e表示；</li>
<li>第12位到63位：储存小数部分（即有效数字），f表示
如图：

  <a
    class="gatsby-resp-image-link"
    href="/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-c1266.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 40.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd6AsD//xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCKv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABcQAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQEAAT8hdGFZp//aAAwDAQACAAMAAAAQAA//xAAVEQEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAwEBPxCH/8QAFREBAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQIBAT8Qp//EABsQAQEAAQUAAAAAAAAAAAAAAAERACExQVFh/9oACAEBAAE/ENZlmUDg7N8sIB8z/9k='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="x"
        title=""
        src="/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-f8fb9.jpg"
        srcset="/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-e8976.jpg 148w,
/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-63df2.jpg 295w,
/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-f8fb9.jpg 590w,
/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-85e3d.jpg 885w,
/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-d1924.jpg 1180w,
/blog/static/IEEE754_floating-9bc58048215bee54b631f607a11b3962-c1266.jpg 1200w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
    </span>
  </span>
  
  </a>
    
符号位决定了一个数的正负，指数部分决定了数值的大小，小数部分决定了数字的精度。IEEE 754规定，有效数字第一位默认总是1，不保存再64位浮点数数之中。也就是说，有效数字总是1.xx…xx的形式，其中xx..xx的部分保存在64位浮点数之中，最长可能为52位。因此，JavaScript提供的有效数字最长为53个二进制位（64位浮点的后52位+有效数字的第一位）。</li>
</ul>
<h3 id="计算过程"><a href="#%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>计算过程</h3>
<p>比如在JavaScript中计算<code class="language-text">0.1+0.2</code>时，到底发生了什么呢？
首先，十进制的<code class="language-text">0.1</code>和<code class="language-text">0.2</code>都会被转换成二进制，但由于浮点数用二进制表达时时无穷的，例如：</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code class="language-javascript"><span class="token number">0.1</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token number">0.0001100110011001</span><span class="token operator">...</span> <span class="token punctuation">(</span>无限<span class="token punctuation">)</span>
<span class="token number">0.2</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token number">0.0011001100110011</span><span class="token operator">...</span> <span class="token punctuation">(</span>无限<span class="token punctuation">)</span></code></pre>
      </div>
<p>IEEE 754标准的64位双精度浮点数的小数部分最多支持53位二进制，所以两者相加之后得到二进制位：</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code class="language-javascript"><span class="token number">0.0100110011001100110011001100110011001100110011001100</span></code></pre>
      </div>
<p>因浮点数小数位的限制而截断的二进制数字，再转换为十进制，就成了<code class="language-text">0.30000000000000004</code>。所以在进行算术计算时会产生误差。</p>
<h3 id="整数精度问题"><a href="#%E6%95%B4%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>整数精度问题</h3>
<p>在JavaScript中，整数精度同样存在的问题，先来看看问题：</p>
<div class="gatsby-highlight">
      <pre class="language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">19571992547450991</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//=> 19571992547450990</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">19571992547450991</span><span class="token operator">===</span><span class="token number">19571992547450992</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//=> true</span></code></pre>
      </div>
<p>同样的原因，在JavaScript中<code class="language-text">Number</code>类型统一按浮点数处理，整数是按最大54位来算最大(2^53-1，Number.MAX<em>SAFE</em>INTEGER，9007199254740991)和最小(-(2^53-1)，Number.MIN<em>SAFE</em>INTEGER,-9007199254740991)安全整数范围。所以只要超过了这个范围，就会存在被社区的精度问题。</p>
<p>当然这个问题并不只是在JavaScript中才会出现，几乎所有的编程语言都采用了IEEE-745浮点数表示法，任何使用二进制浮点数的编程语言都会有这个问题，只不过在很多其他语言中已经封装好了方法来避免精度的问题，而JavaScript是一门弱类型的语言，从设计思想上就没有对浮点数有个严格的数据类型，所以精度误差的问题就显得格外突出。</p>
<h2 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h2>
<h3 id="类库"><a href="#%E7%B1%BB%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类库</h3>
<p>通常这种对精度要求高的计算都应该交给后端去计算和存储，因为后端有成熟的库来解决这种计算问题。前端也有几个不错的库，而且如果前端能及时并准确计算出结果值并展示给用户，能提升不少用户体验</p>
<h4 id="mathjs"><a href="#mathjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Math.js</h4>
<p>Math.js 是专门为 JavaScript 和 Node.js 提供的一个广泛的数学库。它具有灵活的表达式解析器，支持符号计算，配有大量内置函数和常量，并提供集成解决方案来处理不同的数据类型。像数字，大数字(超出安全数的数字)，复数，分数，单位和矩阵。 功能强大，易于使用。</p>
<p>官网：<a href="http://mathjs.org/">http://mathjs.org/</a><br>
Github: <a href="https://github.com/josdejong/mathjs">https://github.com/josdejong/mathjs</a></p>
<h4 id="decimaljs"><a href="#decimaljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>decimal.js</h4>
<p>为JavaScript 提供十进制类型的任意精度数值。</p>
<p>官网：<a href="http://mikemcl.github.io/decimal.js/">http://mikemcl.github.io/decimal.js/</a><br>
GitHub：<a href="https://github.com/MikeMcl/big.js/">https://github.com/MikeMcl/big.js/</a></p>
<h4 id="number-precision"><a href="#number-precision" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>number-precision</h4>
<p>一个小型的JavaScript，专门为了处理高精度浮点数的加减乘除</p>
<p>Github：<a href="https://github.com/nefe/number-precision">https://github.com/nefe/number-precision</a>  </p>
<h3 id="整数"><a href="#%E6%95%B4%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>整数</h3>
<p>把所有小数转化成小数进行计算，再转化成小数（其实这也是number-precision库的核心思路）</p></div><hr style="margin:40px 0 20px;opacity:0.3"/><nav class="page-nav"><a class="page-nav__prev" rel="prev" href="/blog/debug-gulp-task-in-vscode/"><span class="iconfont icon-pre icon"></span><span class="text">在vscode中调试gulp task</span></a><a class="page-nav__next" rel="next" href="/blog/jquery-ts-declaration/"><span class="text">如何为jQuery插件编写声明</span><span class="iconfont icon-next icon"></span></a></nav></section></main><footer class="site-footer"><div class="social-wrapper"><a href="https://github.com/linzebin"><i class="iconfont icon-github"></i></a><a href=""><i class="iconfont icon-wechat"></i></a></div><div>Powered by Gatsby.</div><div>© linzebingo</div></footer></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-dfa073c62e34b396bd52.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","95785716209650":"component---src-templates-blog-index-tsx-6e7953ea7741a02a4747.js","221169156629308":"component---src-templates-blog-post-tsx-4a472efa7d7886c2b0a9.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-2755e7bd01208c101d4d.js","218464284074156":"path---jquery-ts-declaration-0e90de829759ee27411c.js","35175243055970":"path---javascript-number-precision-ad9af8133835ff006f22.js","245776668496479":"path---debug-gulp-task-in-vscode-e81969a203d0372354b7.js","197860263176590":"path---typescript-extends-348783dcc23bccb9a9a0.js","273950069227526":"path---about-d80734070fcd419f1a42.js","22676092666560":"component---src-layouts-index-tsx-9e882ea38acd00a1221a.js"}/*]]>*/</script><script>
            
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto');
      }
      </script><script>/*<![CDATA[*/["/blog/commons-a5db421de3683ad0b4ee.js","/blog/app-dfa073c62e34b396bd52.js","/blog/path---javascript-number-precision-ad9af8133835ff006f22.js","/blog/component---src-templates-blog-post-tsx-4a472efa7d7886c2b0a9.js","/blog/component---src-layouts-index-tsx-9e882ea38acd00a1221a.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>